using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Timers;

namespace Console_Pacman
{
    class Program
    {
        static CPacman pPac;
        static void Main(string[] args)
        {
            pPac = new CPacman();
            pPac.Start();
        }
    }

    class CPacman
    {
        string[,] Board;
        int m_iPosX;
        int m_iPosY;
        int m_iScore;
        int m_iPowerUP; //frames of power up
        bool m_boGameOver;
        bool m_boDebug;
        char m_chrCurDir;    //current direction
        char m_chrDir;       //new direction
        List<CBakDot> LstBakDot = new List<CBakDot>();          //Liste de Dot
        List<CBakPower> LstBakPower = new List<CBakPower>();    //Liste de Power Dot
        CJP GhostJP;
        //debug 
        int fps = 0;


        public CPacman()
        {
            //Board = new string[,] { { "╔", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "╗" }, { /*"║"*/"1", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", /*"║"*/"2" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "P", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "╚", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "╝" } };
            //Board = new string[,] { { "╔", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "3", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "╗" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "╔", "═", "═", "═", "=", "=", "=", "═", "═", "═", "╗", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║", " ", " ", " ", " ", " ", " ", " ", " ", " ", "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "1", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║", " ", " ", " ", " ", " ", " ", " ", " ", " ", "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "2" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║", " ", " ", " ", " ", " ", " ", " ", " ", " ", "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "╚", "═", "═", "═", "═", "═", "═", "═", "═", "═", "╝", "●", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "P", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "╚", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "4", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "╝" } };
            Board = new string[,] { { "╔", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "╗", "╔", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "╗" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║", "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", "╔", "═", "═", "╗", ".", "╔", "═", "═", "═", "╗", ".", "║", "║", ".", "╔", "═", "═", "╗", ".", "╔", "═", "═", "═", "╗", ".", "║" }, { "║", "●", "║", " ", " ", "║", ".", "║", " ", " ", " ", "║", ".", "║", "║", ".", "║", " ", " ", "║", ".", "║", " ", " ", " ", "║", "●", "║" }, { "║", ".", "╚", "═", "═", "╝", ".", "╚", "═", "═", "═", "╝", ".", "╚", "╝", ".", "╚", "═", "═", "╝", ".", "╚", "═", "═", "═", "╝", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", "╔", "═", "═", "╗", ".", "╔", "╗", ".", "╔", "═", "═", "═", "═", "═", "═", "╗", ".", "╔", "╗", ".", "╔", "═", "═", "╗", ".", "║" }, { "║", ".", "╚", "═", "═", "╝", ".", "║", "║", ".", "╚", "═", "═", "╗", "╔", "═", "═", "╝", ".", "║", "║", ".", "╚", "═", "═", "╝", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", "║", "║", ".", ".", ".", ".", "║", "║", ".", ".", ".", ".", "║", "║", ".", ".", ".", ".", ".", ".", "║" }, { "╚", "═", "═", "═", "═", "╗", ".", "║", "╚", "═", "═", "╗", " ", "║", "║", " ", "╔", "═", "═", "╝", "║", ".", "╔", "═", "═", "═", "═", "╝" }, { " ", " ", " ", " ", " ", "║", ".", "║", "╔", "═", "═", "╝", " ", "╚", "╝", " ", "╚", "═", "═", "╗", "║", ".", "║", " ", " ", " ", " ", " " }, { " ", " ", " ", " ", " ", "║", ".", "║", "║", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", "║", "║", ".", "║", " ", " ", " ", " ", " " }, { " ", " ", " ", " ", " ", "║", ".", "║", "║", " ", "╔", "═", "=", "=", "=", "=", "═", "╗", " ", "║", "║", ".", "║", " ", " ", " ", " ", " " }, { "╔", "═", "═", "═", "═", "╝", ".", "╚", "╝", " ", "║", " ", " ", " ", " ", " ", " ", "║", " ", "╚", "╝", ".", "╚", "═", "═", "═", "═", "╗" }, { "1", " ", " ", " ", " ", " ", ".", " ", " ", " ", "║", " ", " ", " ", " ", " ", " ", "║", " ", " ", " ", ".", " ", " ", " ", " ", " ", "2" }, { "╚", "═", "═", "═", "═", "╗", ".", "╔", "╗", " ", "║", " ", " ", " ", " ", " ", " ", "║", " ", "╔", "╗", ".", "╔", "═", "═", "═", "═", "╝" }, { " ", " ", " ", " ", " ", "║", ".", "║", "║", ".", "╚", "═", "═", "═", "═", "═", "═", "╝", ".", "║", "║", ".", "║", " ", " ", " ", " ", " " }, { " ", " ", " ", " ", " ", "║", ".", "║", "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║", "║", ".", "║", " ", " ", " ", " ", " " }, { " ", " ", " ", " ", " ", "║", ".", "║", "║", ".", "╔", "═", "═", "═", "═", "═", "═", "╗", ".", "║", "║", ".", "║", " ", " ", " ", " ", " " }, { "╔", "═", "═", "═", "═", "╝", ".", "╚", "╝", ".", "╚", "═", "═", "╗", "╔", "═", "═", "╝", ".", "╚", "╝", ".", "╚", "═", "═", "═", "═", "╗" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║", "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", "╔", "═", "═", "╗", ".", "╔", "═", "═", "═", "╗", ".", "║", "║", ".", "╔", "═", "═", "═", "╗", ".", "╔", "═", "═", "╗", ".", "║" }, { "║", ".", "╚", "═", "╗", "║", ".", "╚", "═", "═", "═", "╝", ".", "╚", "╝", ".", "╚", "═", "═", "═", "╝", ".", "║", "╔", "═", "╝", ".", "║" }, { "║", "●", ".", ".", "║", "║", ".", ".", ".", ".", ".", ".", ".", ".", "P", ".", ".", ".", ".", ".", ".", ".", "║", "║", ".", ".", "●", "║" }, { "╚", "═", "╗", ".", "║", "║", ".", "╔", "╗", ".", "╔", "═", "═", "═", "═", "═", "═", "╗", ".", "╔", "╗", ".", "║", "║", ".", "╔", "═", "╝" }, { "╔", "═", "╝", ".", "╚", "╝", ".", "║", "║", ".", "╚", "═", "═", "╗", "╔", "═", "═", "╝", ".", "║", "║", ".", "╚", "╝", ".", "╚", "═", "╗" }, { "║", ".", ".", ".", ".", ".", ".", "║", "║", ".", ".", ".", ".", "║", "║", ".", ".", ".", ".", "║", "║", ".", ".", ".", ".", ".", ".", "║" }, { "║", ".", "╔", "═", "═", "═", "═", "╝", "╚", "═", "═", "╗", ".", "║", "║", ".", "╔", "═", "═", "╝", "╚", "═", "═", "═", "═", "╗", ".", "║" }, { "║", ".", "╚", "═", "═", "═", "═", "═", "═", "═", "═", "╝", ".", "╚", "╝", ".", "╚", "═", "═", "═", "═", "═", "═", "═", "═", "╝", ".", "║" }, { "║", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", ".", "║" }, { "╚", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "═", "╝" } };
            m_boGameOver = false;
            m_iScore = 0;
            m_iPowerUP = 0;
        }

        private void init()
        {
            m_boDebug = false;
            for (int i = 0; i < Board.GetLength(0); i++)
                for (int j = 0; j < Board.GetLength(1); j++)
                {
                    if (Board[i, j] == "P")
                    {
                        m_iPosX = i;
                        m_iPosY = j;
                    }
                    else if (Board[i, j] == ".")
                        LstBakDot.Add(new CBakDot(i, j));
                    else if (Board[i, j] == "●")
                        LstBakPower.Add(new CBakPower(i, j));
                }
            if (!(m_iPosX > 0 && m_iPosY > 0 && m_iPosX < Board.GetLength(0) - 1 && m_iPosY < Board.GetLength(1) - 1))
            {
                m_boGameOver = true;
                Console.WriteLine("Board incorrect");
                Console.ReadKey();
            }
        }

        public void Start()
        {
            Console.OutputEncoding = System.Text.Encoding.UTF8;
            
            init();
            while (!m_boGameOver)
            {
                Afficher();
                KeyInput();
                Move();

                if (LstBakDot.Count() == 0 && LstBakPower.Count() == 0)
                {
                    m_boGameOver = true;
                    Console.Clear();
                    Console.ForegroundColor = ConsoleColor.Yellow;
                    Console.WriteLine("WON");
                }
                System.Threading.Thread.Sleep(30);  //tellement la pire affaire
            }

            Console.ReadLine();
        }


        private void Afficher()
        {
            Console.SetCursorPosition(0, 0);
            Console.ForegroundColor = ConsoleColor.DarkRed;
            Console.WriteLine("BakerMan            Score: " + m_iScore);

            for (int i = 0; i < Board.GetLength(0); i++)
            {
                for (int j = 0; j < Board.GetLength(1); j++)
                {
                    if (Board[i, j] == "╔" || Board[i, j] == "╗" || Board[i, j] == "╝" ||
                        Board[i, j] == "╚" || Board[i, j] == "═" || Board[i, j] == "║")
                    {
                        Console.ForegroundColor = ConsoleColor.Blue;
                        Console.Write(" " + Board[i, j]);
                    }
                    else if(Board[i,j] == "=")
                    {
                        Console.ForegroundColor = ConsoleColor.DarkGray;
                        Console.Write(" " + Board[i, j]);
                    }
                    else if (i == m_iPosX && j == m_iPosY)
                    {
                        if (m_iPowerUP > 0)
                            Console.ForegroundColor = ConsoleColor.Magenta;
                        else
                            Console.ForegroundColor = ConsoleColor.Yellow;
                        Console.Write(" P");
                    }
                    else if (LstBakDot.FindIndex(x => (x.m_iPosX == i) && (x.m_iPosY == j)) > -1)
                    {
                        Console.ForegroundColor = ConsoleColor.White;
                        Console.Write(" .");
                    }
                    else if (LstBakPower.FindIndex(x => (x.m_iPosX == i) && (x.m_iPosY == j)) > -1)
                    {
                        Console.ForegroundColor = ConsoleColor.White;
                        Console.Write(" ●");
                    }
                    else
                        Console.Write("  ");
                }

                Console.WriteLine();
            }


            //Debug
            fps++;
            if (m_boDebug)
            {
                Console.SetWindowSize(Console.WindowWidth, 40);
                Console.ForegroundColor = ConsoleColor.Cyan;
                Console.WriteLine("Coord: " + m_iPosX + ", " + m_iPosY);
                Console.WriteLine("Dir: " + m_chrCurDir.ToString());
                Console.WriteLine("Dot left: " + LstBakDot.Count());
                Console.WriteLine("PowerUP Time: " + m_iPowerUP);
                Console.WriteLine("FPS count: " + fps);
                //U+2500
                Console.WriteLine("☼ ● ○ ♠ ♣ ♥ ♦");
            }
            else
                Console.SetWindowSize(85, 35);

        }

        /// <summary>
        /// KeyListener equivalent
        /// </summary>
        private void KeyInput()
        {
            if (Console.KeyAvailable)
            {
                ConsoleKeyInfo key = Console.ReadKey(true);
                switch (key.Key)
                {
                    case ConsoleKey.UpArrow:
                        m_chrDir = 'N';
                        break;
                    case ConsoleKey.DownArrow:
                        m_chrDir = 'S';
                        break;
                    case ConsoleKey.LeftArrow:
                        m_chrDir = 'W';
                        break;
                    case ConsoleKey.RightArrow:
                        m_chrDir = 'E';
                        break;
                    case ConsoleKey.W:
                        m_chrDir = 'N';
                        break;
                    case ConsoleKey.S:
                        m_chrDir = 'S';
                        break;
                    case ConsoleKey.A:
                        m_chrDir = 'W';
                        break;
                    case ConsoleKey.D:
                        m_chrDir = 'E';
                        break;
                    case ConsoleKey.F1:
                        m_boDebug = !m_boDebug;
                        Console.Clear();
                        break;
                    default:
                        break;
                }
            }
        }


        private void Move()
        {
            //eat a pellet
            int remIndexDot = LstBakDot.FindIndex(x => (x.m_iPosX == m_iPosX) && (x.m_iPosY == m_iPosY));
            if (remIndexDot != -1)
            {
                LstBakDot.RemoveAt(remIndexDot);
                m_iScore++;
            }
            //eat a power pellet
            int remIndexPow = LstBakPower.FindIndex(x => (x.m_iPosX == m_iPosX) && (x.m_iPosY == m_iPosY));
            if (remIndexPow != -1)
            {
                m_iPowerUP = 200;
                LstBakPower.RemoveAt(remIndexPow);
                m_iScore += 10;
            }

            
         
            if (m_chrDir == 'N' && (Board[m_iPosX - 1, m_iPosY] != "═") && m_iPosX != 0 &&
                (Board[m_iPosX - 1, m_iPosY] != "╝") && (Board[m_iPosX - 1, m_iPosY] != "╚"))
                m_iPosX--;
            else if (m_chrDir == 'S' && (Board[m_iPosX + 1, m_iPosY] != "═") && m_iPosX != Board.GetLength(0) &&
                (Board[m_iPosX + 1, m_iPosY] != "╗") && (Board[m_iPosX + 1, m_iPosY] != "╔") && (Board[m_iPosX + 1, m_iPosY] != "="))
                m_iPosX++;
            else if (m_chrDir == 'E' && (Board[m_iPosX, m_iPosY + 1] != "║") && m_iPosY != Board.GetLength(1) &&
                (Board[m_iPosX, m_iPosY + 1] != "╔") && (Board[m_iPosX, m_iPosY + 1] != "╚"))
                m_iPosY++;
            else if (m_chrDir == 'W' && (Board[m_iPosX, m_iPosY - 1] != "║") && m_iPosY != 0 &&
                (Board[m_iPosX, m_iPosY - 1] != "╝") && (Board[m_iPosX, m_iPosY - 1] != "╗"))
                m_iPosY--;


            //C++ snake code for portal colision (adapted)
            int iPortal;
            if ((m_iPosX == 0 || m_iPosX == Board.GetLength(0) - 1 || m_iPosY == 0 || m_iPosY == Board.GetLength(1) - 1))
            {
                int iPortalNb = int.Parse(Board[m_iPosX, m_iPosY]);
                if (iPortalNb % 2 == 0)
                {
                    for (int ii = 0; ii <= Board.GetLength(0) - 1; ii++)		//double boucle pour parcourir et afficher le labyrinthe
                        for (int ij = 0; ij <= Board.GetLength(1) - 1; ij++)
                            if (Int32.TryParse(Board[ii, ij], out iPortal))
                                if (iPortal == iPortalNb - 1)
                                {
                                    m_iPosX = ii; m_iPosY = ij;
                                }
                }
                else
                {
                    for (int ii = 0; ii <= Board.GetLength(0)-1; ii++)		//double boucle pour parcourir et afficher le labyrinthe
                        for (int ij = 0; ij <= Board.GetLength(1)-1; ij++)
                            if (Int32.TryParse(Board[ii, ij], out iPortal))
                                if (iPortal == iPortalNb + 1)
                                {
                                    m_iPosX = ii; m_iPosY = ij;
                                }
                }
            }

            //reduce PowerUP duration by a frame
            if (m_iPowerUP > 0)
                m_iPowerUP--;
        }

    }

    class CBakDot
    {
        public int m_iPosX { get; set; }
        public int m_iPosY { get; set; }

        public CBakDot(int _iPosX, int _iPosY)
        {
            m_iPosX = _iPosX;
            m_iPosY = _iPosY;
        }
    }

    class CBakPower
    {
        public int m_iPosX { get; set; }
        public int m_iPosY { get; set; }

        public CBakPower(int _iPosX, int _iPosY)
        {
            m_iPosX = _iPosX;
            m_iPosY = _iPosY;
        }
    }

    class CJP
    {
        public int m_iPosX { get; set; }
        public int m_iPosY { get; set; }

        public CJP(int _iPosX, int _iPosY)
        {
            m_iPosX = _iPosX;
            m_iPosY = _iPosY;
        }
    }
    
}
